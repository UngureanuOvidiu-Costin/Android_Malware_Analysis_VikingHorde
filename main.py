import sys
import time
import frida

# spawn() method to start target application
# and attach() method to attach to the process of the application
# then read the Frida script from disk and register an event hadler for "message" events
# Finnaly load the script, RESUMING the session and waiting to interract with the app to
# generate logs
# The app uses time.sleep(2) to ensure that the application has enough time to start and the script is attached
# correctly.


# Register event handler
def on_message(message, data):
    print(message)



# Start application
device = frida.get_usb_device()
session = device.spawn("com.sysmanager")
time.sleep(1)

# Attack to the proccess of the applicaiton
proccess = frida.get_usb_device().attach(session)

# Read Frida script from disk
script = proccess.create_script(open("SkyGoFree.js").read())
time.sleep(2)
script.on('message', on_message)

script.load()
time.sleep(2)
device.resume(session)

start_time = time.time()
current_time = time.time()

sys.stdin.read()
